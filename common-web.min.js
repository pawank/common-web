(function(){function p(a,b,d){d=$.extend(!0,{},e.options.globalProperties,m(d,[a,b]));b={element:e.Transformations.elementToProperties(b,null)};var c={event:e.Transformations.eventToProperties(a)};a=q(a);null!=a&&(b.extra=a.element,c.x=a.x,c.y=a.y);return $.extend(!0,{},d,b,c,a)}function r(a,b,d){d=$.extend(!0,{},e.options.globalProperties,m(d,[a,b]));b={element:e.Transformations.elementToProperties(b,null)};var c={event:e.Transformations.eventToProperties(a)};a=q(a);null!=a&&(b.extra=a.element,c.x=
a.x,c.y=a.y);return $.extend(!0,{},d,b,c,a)}function s(a,b,d){d=$.extend(!0,{},e.options.globalProperties,m(d,[a,b]));b={element:e.Transformations.formElementToProperties(b)};a={event:e.Transformations.eventToProperties(a)};return $.extend(!0,{},d,b,a)}function m(a,b){return"function"===typeof a?a.apply(window,b):a}function q(a){if(null!=a){var b={},d=a.clientX,c=a.clientY;a=document.elementFromPoint(d,c);var e=a.name,l=a.id;"undefined"===typeof e&&(e="");"undefined"===typeof l&&(l="");for(var n=
a.attributes,h=[],g=n.length-1;0<=g;g--){var f={};f.name=n[g].name;f.val=n[g].value;h.push(f)}b.x=d;b.y=c;d={};d.name=e;d.id=l;d.attrs=h;d.type=a.tagName;d.domtype=a+"";b.element=d;return b}}var f={pageviewsEventName:"pageviews",inputChangeEventName:"input-changes",mousehoverEventName:"mousehover-event",clicksEventName:"clicks",formSubmissionsEventName:"form-submissions",callbackTimeout:1E3,globalProperties:{page_url:window.location.href,referrer_url:document.referrer}},e={options:f,addGlobalProperties:function(a){$.extend(e.options.globalProperties,
a)},trackSession:function(a,b){"string"!==typeof a&&(a="common_web_guid");for(var d=document.cookie.split("; "),c=null,k=0;k<d.length;k++)if(cookieParts=d[k].split("="),cookieParts[0]===a){c=cookieParts[1];break}null===c&&("string"===typeof b?c=b:(genSub=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},c=genSub()+genSub()+"-"+genSub()+"-"+genSub()+"-"+genSub()+"-"+genSub()+genSub()+genSub()),expiration_date=new Date,expiration_date.setFullYear(expiration_date.getFullYear()+
1),cookie_string=a+"="+c+"; path/; expires="+expiration_date.toGMTString(),document.cookie=cookie_string);e.addGlobalProperties({guid:c});return c},trackPageview:function(a){a=$.extend(!0,{},e.options.globalProperties,m(a));e.Callback(e.options.pageviewsEventName,a)},trackClicks:function(a,b){"undefined"===typeof a&&(a=$("a"));$.each(a,function(a,c){$(c).on("click",function(a){var d=e.options.callbackTimeout,n=p(a,c,b),h=function(){};!c.href||"_blank"===c.target||a.metaKey||a.altKey||a.ctrlKey||a.shiftKey||
(h=function(){window.location.href=c.href},a.preventDefault(),setTimeout(function(){window.location.href=c.href},d));e.Callback(f.clicksEventName,n,h)})})},trackClicksPassive:function(a,b){$.each(a,function(a,c){$(c).on("click",function(a){a=p(a,c,b);e.Callback(f.clicksEventName,a)})})},trackFormSubmissions:function(a,b){"undefined"===typeof a&&(a=$("form"));$.each(a,function(a,c){var k=e.options.callbackTimeout,l=!1;$(c).on("submit",function(a){var d=s(a,c,b),g=function(){},g=function(){l||(l=!0,
c.submit())};a.preventDefault();setTimeout(function(){l=!0;c.submit()},k);e.Callback(f.formSubmissionsEventName,d,g)})})},trackInputChanges:function(a,b){"undefined"===typeof a&&(a=$("input, textarea, select"));$.each(a,function(a,c){var k=$(c).val();$(c).on("change",function(a){var d,h=k;d=$.extend(!0,{},e.options.globalProperties,m(b,[a,c]));var g={element:e.Transformations.inputElementToProperties(c)};h&&""!==h&&(g.element.previousValue=h);a={event:e.Transformations.eventToProperties(a)};d=$.extend(!0,
{},d,g,a);e.Callback(f.inputChangeEventName,d);k=$(c).val()})})},trackMousehoverChanges:function(a,b){"undefined"===typeof a?$(window).mouseover(function(a){var c=document.elementFromPoint(a.clientX,a.clientY);a=r(a,c,b);e.Callback(f.mousehoverEventName,a)}):$.each(a,function(a,c){$(c).on("mousehover",function(a){a=r(a,c,b);e.Callback(f.mousehoverEventName,a)})})},Transformations:{eventToProperties:function(a){var b={};b.timestamp=a.timestamp;b.type=a.type;b.metaKey=a.metaKey;return b},elementToProperties:function(a,
b){var d=b||{};d.tagName=a.tagName;"A"===a.tagName&&(d.text=a.innerText);$(a.attributes).each(function(a,b){d[b.nodeName]=b.value});var c=$(a).attr("class");c&&(d.classes=c.split(/\s+/));d.path=$(a).getPath();return d},formElementToProperties:function(a){var b={};b.form_values=$(a).serializeArray();return this.elementToProperties(a,b)},inputElementToProperties:function(a){var b={value:$(a).val()},d=$(a).closest("form");0<d.size()&&(b.form=this.elementToProperties(d[0]));return this.elementToProperties(a,
b)}}};jQuery.fn.extend({getPath:function(a){"undefined"==typeof a&&(a="");if(this.is("html"))return"html"+a;var b=this.get(0).nodeName.toLowerCase(),d=this.attr("id"),c=this.attr("class");"undefined"!=typeof d&&(b+="#"+d);"undefined"!=typeof c&&(b+="."+c.split(/[\s\n]+/).join("."));return this.parent().getPath(" > "+b+a)}});e.Keen={Client:null,Debug:!1,Callback:function(a,b,d){e.Keen.Client.addEvent(a,b,function(){e.Keen.Debug&&console.log(a+": "+JSON.stringify(b));d&&d()})},globalProperties:{keen:{addons:[{name:"keen:ip_to_geo",
input:{ip:"ip_address"},output:"ip_geo_info"},{name:"keen:ua_parser",input:{ua_string:"user_agent"},output:"parsed_user_agent"},{name:"keen:url_parser",input:{url:"page_url"},output:"parsed_page_url"},{name:"keen:referrer_parser",input:{referrer_url:"referrer_url",page_url:"page_url"},output:"referrer_info"}]},ip_address:"${keen.ip}",user_agent:"${keen.user_agent}"}};window.CommonWeb=e})();
